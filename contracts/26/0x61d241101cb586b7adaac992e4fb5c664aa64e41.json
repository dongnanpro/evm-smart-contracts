{
  "address": "0x61d241101cb586b7adaac992e4fb5c664aa64e41",
  "chain": "ETH",
  "chainID": 1,
  "verifier": "etherscan.io",
  "commonName": "",
  "contractName": "PaymentProcessor",
  "compilerVersion": "v0.5.8+commit.23d335f2",
  "optimization": true,
  "runs": "200",
  "evmVersion": "default",
  "sourceCode": "/**\n *Submitted for verification at Etherscan.io on 2019-05-14\n*/\n\n// File: openzeppelin-solidity/contracts/ownership/Ownable.sol\n\npragma solidity ^0.5.0;\n\n/**\n * @title Ownable\n * @dev The Ownable contract has an owner address, and provides basic authorization control\n * functions, this simplifies the implementation of \"user permissions\".\n */\ncontract Ownable {\n    address private _owner;\n\n    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);\n\n    /**\n     * @dev The Ownable constructor sets the original `owner` of the contract to the sender\n     * account.\n     */\n    constructor () internal {\n        _owner = msg.sender;\n        emit OwnershipTransferred(address(0), _owner);\n    }\n\n    /**\n     * @return the address of the owner.\n     */\n    function owner() public view returns (address) {\n        return _owner;\n    }\n\n    /**\n     * @dev Throws if called by any account other than the owner.\n     */\n    modifier onlyOwner() {\n        require(isOwner());\n        _;\n    }\n\n    /**\n     * @return true if `msg.sender` is the owner of the contract.\n     */\n    function isOwner() public view returns (bool) {\n        return msg.sender == _owner;\n    }\n\n    /**\n     * @dev Allows the current owner to relinquish control of the contract.\n     * @notice Renouncing to ownership will leave the contract without an owner.\n     * It will not be possible to call the functions with the `onlyOwner`\n     * modifier anymore.\n     */\n    function renounceOwnership() public onlyOwner {\n        emit OwnershipTransferred(_owner, address(0));\n        _owner = address(0);\n    }\n\n    /**\n     * @dev Allows the current owner to transfer control of the contract to a newOwner.\n     * @param newOwner The address to transfer ownership to.\n     */\n    function transferOwnership(address newOwner) public onlyOwner {\n        _transferOwnership(newOwner);\n    }\n\n    /**\n     * @dev Transfers control of the contract to a newOwner.\n     * @param newOwner The address to transfer ownership to.\n     */\n    function _transferOwnership(address newOwner) internal {\n        require(newOwner != address(0));\n        emit OwnershipTransferred(_owner, newOwner);\n        _owner = newOwner;\n    }\n}\n\n// File: openzeppelin-solidity/contracts/token/ERC20/IERC20.sol\n\npragma solidity ^0.5.0;\n\n/**\n * @title ERC20 interface\n * @dev see https://github.com/ethereum/EIPs/issues/20\n */\ninterface IERC20 {\n    function transfer(address to, uint256 value) external returns (bool);\n\n    function approve(address spender, uint256 value) external returns (bool);\n\n    function transferFrom(address from, address to, uint256 value) external returns (bool);\n\n    function totalSupply() external view returns (uint256);\n\n    function balanceOf(address who) external view returns (uint256);\n\n    function allowance(address owner, address spender) external view returns (uint256);\n\n    event Transfer(address indexed from, address indexed to, uint256 value);\n\n    event Approval(address indexed owner, address indexed spender, uint256 value);\n}\n\n// File: contracts/uniswap/UniswapExchangeInterface.sol\n\npragma solidity ^0.5.0;\n\ncontract UniswapExchangeInterface {\n    // Address of ERC20 token sold on this exchange\n    function tokenAddress() external view returns (address token);\n    // Address of Uniswap Factory\n    function factoryAddress() external view returns (address factory);\n    // Provide Liquidity\n    function addLiquidity(uint256 min_liquidity, uint256 max_tokens, uint256 deadline) external payable returns (uint256);\n    function removeLiquidity(uint256 amount, uint256 min_eth, uint256 min_tokens, uint256 deadline) external returns (uint256, uint256);\n    // Get Prices\n    function getEthToTokenInputPrice(uint256 eth_sold) external view returns (uint256 tokens_bought);\n    function getEthToTokenOutputPrice(uint256 tokens_bought) external view returns (uint256 eth_sold);\n    function getTokenToEthInputPrice(uint256 tokens_sold) external view returns (uint256 eth_bought);\n    function getTokenToEthOutputPrice(uint256 eth_bought) external view returns (uint256 tokens_sold);\n    // Trade ETH to ERC20\n    function ethToTokenSwapInput(uint256 min_tokens, uint256 deadline) external payable returns (uint256  tokens_bought);\n    function ethToTokenTransferInput(uint256 min_tokens, uint256 deadline, address recipient) external payable returns (uint256  tokens_bought);\n    function ethToTokenSwapOutput(uint256 tokens_bought, uint256 deadline) external payable returns (uint256  eth_sold);\n    function ethToTokenTransferOutput(uint256 tokens_bought, uint256 deadline, address recipient) external payable returns (uint256  eth_sold);\n    // Trade ERC20 to ETH\n    function tokenToEthSwapInput(uint256 tokens_sold, uint256 min_eth, uint256 deadline) external returns (uint256  eth_bought);\n    function tokenToEthTransferInput(uint256 tokens_sold, uint256 min_tokens, uint256 deadline, address recipient) external returns (uint256  eth_bought);\n    function tokenToEthSwapOutput(uint256 eth_bought, uint256 max_tokens, uint256 deadline) external returns (uint256  tokens_sold);\n    function tokenToEthTransferOutput(uint256 eth_bought, uint256 max_tokens, uint256 deadline, address recipient) external returns (uint256  tokens_sold);\n    // Trade ERC20 to ERC20\n    function tokenToTokenSwapInput(uint256 tokens_sold, uint256 min_tokens_bought, uint256 min_eth_bought, uint256 deadline, address token_addr) external returns (uint256  tokens_bought);\n    function tokenToTokenTransferInput(uint256 tokens_sold, uint256 min_tokens_bought, uint256 min_eth_bought, uint256 deadline, address recipient, address token_addr) external returns (uint256  tokens_bought);\n    function tokenToTokenSwapOutput(uint256 tokens_bought, uint256 max_tokens_sold, uint256 max_eth_sold, uint256 deadline, address token_addr) external returns (uint256  tokens_sold);\n    function tokenToTokenTransferOutput(uint256 tokens_bought, uint256 max_tokens_sold, uint256 max_eth_sold, uint256 deadline, address recipient, address token_addr) external returns (uint256  tokens_sold);\n    // Trade ERC20 to Custom Pool\n    function tokenToExchangeSwapInput(uint256 tokens_sold, uint256 min_tokens_bought, uint256 min_eth_bought, uint256 deadline, address exchange_addr) external returns (uint256  tokens_bought);\n    function tokenToExchangeTransferInput(uint256 tokens_sold, uint256 min_tokens_bought, uint256 min_eth_bought, uint256 deadline, address recipient, address exchange_addr) external returns (uint256  tokens_bought);\n    function tokenToExchangeSwapOutput(uint256 tokens_bought, uint256 max_tokens_sold, uint256 max_eth_sold, uint256 deadline, address exchange_addr) external returns (uint256  tokens_sold);\n    function tokenToExchangeTransferOutput(uint256 tokens_bought, uint256 max_tokens_sold, uint256 max_eth_sold, uint256 deadline, address recipient, address exchange_addr) external returns (uint256  tokens_sold);\n    // ERC20 comaptibility for liquidity tokens\n    bytes32 public name;\n    bytes32 public symbol;\n    uint256 public decimals;\n    function transfer(address _to, uint256 _value) external returns (bool);\n    function transferFrom(address _from, address _to, uint256 value) external returns (bool);\n    function approve(address _spender, uint256 _value) external returns (bool);\n    function allowance(address _owner, address _spender) external view returns (uint256);\n    function balanceOf(address _owner) external view returns (uint256);\n    // Never use\n    function setup(address token_addr) external;\n}\n\n// File: contracts/uniswap/UniswapFactoryInterface.sol\n\npragma solidity ^0.5.0;\n\ncontract UniswapFactoryInterface {\n    // Public Variables\n    address public exchangeTemplate;\n    uint256 public tokenCount;\n    // Create Exchange\n    function createExchange(address token) external returns (address exchange);\n    // Get Exchange and Token Info\n    function getExchange(address token) external view returns (address exchange);\n    function getToken(address exchange) external view returns (address token);\n    function getTokenWithId(uint256 tokenId) external view returns (address token);\n    // Never use\n    function initializeFactory(address template) external;\n}\n\n// File: contracts/PaymentProcessor.sol\n\npragma solidity ^0.5.0;\n\n\n\n\n\ncontract PaymentProcessor is Ownable {\n    uint256 constant UINT256_MAX = ~uint256(0);\n\n    address public fundManager;\n    UniswapFactoryInterface public uniswapFactory;\n    address public intermediaryToken;\n    UniswapExchangeInterface public intermediaryTokenExchange;\n\n    constructor(UniswapFactoryInterface uniswapFactory_)\n        public {\n        uniswapFactory = uniswapFactory_;\n    }\n\n    function setFundManager(address fundManager_)\n        onlyOwner\n        public {\n        fundManager = fundManager_;\n    }\n\n    function isFundManager()\n        public view\n        returns (bool) {\n        return isOwner() || msg.sender == fundManager;\n    }\n\n    function setIntermediaryToken(address token)\n        onlyFundManager\n        external {\n        intermediaryToken = token;\n        if (token != address(0)) {\n            intermediaryTokenExchange = UniswapExchangeInterface(uniswapFactory.getExchange(token));\n            require(address(intermediaryTokenExchange) != address(0), \"The token does not have an exchange\");\n        } else {\n            intermediaryTokenExchange = UniswapExchangeInterface(address(0));\n        }\n    }\n\n    function depositEther(uint64 orderId)\n        payable\n        external {\n        require(msg.value > 0, \"Minimal deposit is 0\");\n        uint256 amountBought = 0;\n        if (intermediaryToken != address(0)) {\n            amountBought = intermediaryTokenExchange.ethToTokenSwapInput.value(msg.value)(\n                1 /* min_tokens */,\n                UINT256_MAX /* deadline */);\n        }\n        emit EtherDepositReceived(orderId, msg.value, intermediaryToken, amountBought);\n    }\n\n    function withdrawEther(uint256 amount, address payable to)\n        onlyFundManager\n        external {\n        to.transfer(amount);\n        emit EtherDepositWithdrawn(to, amount);\n    }\n\n    function withdrawToken(IERC20 token, uint256 amount, address to)\n        onlyFundManager\n        external {\n        require(token.transfer(to, amount), \"Withdraw token failed\");\n        emit TokenDepositWithdrawn(address(token), to, amount);\n    }\n\n\n    function depositToken(uint64 orderId, address depositor, IERC20 inputToken, uint256 amount)\n        hasExchange(address(inputToken))\n        onlyFundManager\n        external {\n        require(address(inputToken) != address(0), \"Input token cannont be ZERO_ADDRESS\");\n        UniswapExchangeInterface tokenExchange = UniswapExchangeInterface(uniswapFactory.getExchange(address(inputToken)));\n        require(inputToken.allowance(depositor, address(this)) >= amount, \"Not enough allowance\");\n        inputToken.transferFrom(depositor, address(this), amount);\n        uint256 amountBought = 0;\n        if (intermediaryToken != address(0)) {\n            if (intermediaryToken != address(inputToken)) {\n                inputToken.approve(address(tokenExchange), amount);\n                amountBought = tokenExchange.tokenToTokenSwapInput(\n                    amount /* (input) tokens_sold */,\n                    1 /* (output) min_tokens_bought */,\n                    1 /*  min_eth_bought */,\n                    UINT256_MAX /* deadline */,\n                    intermediaryToken /* (input) token_addr */);\n            } else {\n                // same token\n                amountBought = amount;\n            }\n        } else {\n            inputToken.approve(address(tokenExchange), amount);\n            amountBought = tokenExchange.tokenToEthSwapInput(\n                amount /* tokens_sold */,\n                1 /* min_eth */,\n                UINT256_MAX /* deadline */);\n        }\n        emit TokenDepositReceived(orderId, address(inputToken), amount, intermediaryToken, amountBought);\n    }\n\n    event EtherDepositReceived(uint64 indexed orderId, uint256 amount, address intermediaryToken, uint256 amountBought);\n    event EtherDepositWithdrawn(address to, uint256 amount);\n    event TokenDepositReceived(uint64 indexed orderId, address indexed inputToken, uint256 amount, address intermediaryToken, uint256 amountBought);\n    event TokenDepositWithdrawn(address indexed token, address to, uint256 amount);\n\n    modifier hasExchange(address token) {\n        address tokenExchange = uniswapFactory.getExchange(token);\n        require(tokenExchange != address(0), \"Token doesn't have an exchange\");\n        _;\n    }\n\n    modifier onlyFundManager() {\n        require(isFundManager(), \"Only fund manager allowed\");\n        _;\n    }\n}",
  "bytecode": "608060405234801561001057600080fd5b506040516020806111428339810180604052602081101561003057600080fd5b5051600080546001600160a01b03191633178082556040516001600160a01b039190911691907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908290a3600280546001600160a01b0319166001600160a01b0392909216919091179055611098806100aa6000396000f3fe6080604052600436106100e85760003560e01c8063715018a61161008a578063b7c3f23511610059578063b7c3f235146102c0578063ca3e5333146102d5578063ce56c454146102ea578063f2fde38b14610323576100e8565b8063715018a6146102585780638bdb2afa1461026d5780638da5cb5b146102825780638f32d59b14610297576100e8565b80633ccdbb28116100c65780633ccdbb281461018657806355d8e631146101c95780636209ec2d1461021c5780636f557c3514610231576100e8565b8063219f0f8c146100ed578063232a30601461011e5780632ca0d9aa14610153575b600080fd5b3480156100f957600080fd5b50610102610356565b604080516001600160a01b039092168252519081900360200190f35b34801561012a57600080fd5b506101516004803603602081101561014157600080fd5b50356001600160a01b0316610365565b005b34801561015f57600080fd5b506101516004803603602081101561017657600080fd5b50356001600160a01b0316610398565b34801561019257600080fd5b50610151600480360360608110156101a957600080fd5b506001600160a01b038135811691602081013591604090910135166104f7565b3480156101d557600080fd5b50610151600480360360808110156101ec57600080fd5b5067ffffffffffffffff813516906001600160a01b0360208201358116916040810135909116906060013561066c565b34801561022857600080fd5b50610102610c9a565b6101516004803603602081101561024757600080fd5b503567ffffffffffffffff16610ca9565b34801561026457600080fd5b50610151610dfd565b34801561027957600080fd5b50610102610e58565b34801561028e57600080fd5b50610102610e67565b3480156102a357600080fd5b506102ac610e76565b604080519115158252519081900360200190f35b3480156102cc57600080fd5b50610102610e87565b3480156102e157600080fd5b506102ac610e96565b3480156102f657600080fd5b506101516004803603604081101561030d57600080fd5b50803590602001356001600160a01b0316610eba565b34801561032f57600080fd5b506101516004803603602081101561034657600080fd5b50356001600160a01b0316610f83565b6004546001600160a01b031681565b61036d610e76565b61037657600080fd5b600180546001600160a01b0319166001600160a01b0392909216919091179055565b6103a0610e96565b6103e25760408051600160e51b62461bcd028152602060048201526019602482015260008051602061104d833981519152604482015290519081900360640190fd5b600380546001600160a01b0319166001600160a01b038316908117909155156104e35760025460408051600160e11b6303795fb10281526001600160a01b038481166004830152915191909216916306f2bf62916024808301926020929190829003018186803b15801561045557600080fd5b505afa158015610469573d6000803e3d6000fd5b505050506040513d602081101561047f57600080fd5b5051600480546001600160a01b0319166001600160a01b039283161790819055166104de57604051600160e51b62461bcd0281526004018080602001828103825260238152602001806110076023913960400191505060405180910390fd5b6104f4565b600480546001600160a01b03191690555b50565b6104ff610e96565b6105415760408051600160e51b62461bcd028152602060048201526019602482015260008051602061104d833981519152604482015290519081900360640190fd5b826001600160a01b031663a9059cbb82846040518363ffffffff1660e01b815260040180836001600160a01b03166001600160a01b0316815260200182815260200192505050602060405180830381600087803b1580156105a157600080fd5b505af11580156105b5573d6000803e3d6000fd5b505050506040513d60208110156105cb57600080fd5b50516106215760408051600160e51b62461bcd02815260206004820152601560248201527f576974686472617720746f6b656e206661696c65640000000000000000000000604482015290519081900360640190fd5b604080516001600160a01b038381168252602082018590528251908616927fa9417e1e73e279b2963e64c5af2ab0cbe7f5e8ccb20b750455aa4ff508a0ff89928290030190a2505050565b60025460408051600160e11b6303795fb10281526001600160a01b0380861660048301529151859360009316916306f2bf62916024808301926020929190829003018186803b1580156106be57600080fd5b505afa1580156106d2573d6000803e3d6000fd5b505050506040513d60208110156106e857600080fd5b505190506001600160a01b03811661074a5760408051600160e51b62461bcd02815260206004820152601e60248201527f546f6b656e20646f65736e2774206861766520616e2065786368616e67650000604482015290519081900360640190fd5b610752610e96565b6107945760408051600160e51b62461bcd028152602060048201526019602482015260008051602061104d833981519152604482015290519081900360640190fd5b6001600160a01b0384166107dc57604051600160e51b62461bcd02815260040180806020018281038252602381526020018061102a6023913960400191505060405180910390fd5b60025460408051600160e11b6303795fb10281526001600160a01b038781166004830152915160009392909216916306f2bf6291602480820192602092909190829003018186803b15801561083057600080fd5b505afa158015610844573d6000803e3d6000fd5b505050506040513d602081101561085a57600080fd5b505160408051600160e11b636eb1769f0281526001600160a01b038981166004830152306024830152915192935086929188169163dd62ed3e91604480820192602092909190829003018186803b1580156108b457600080fd5b505afa1580156108c8573d6000803e3d6000fd5b505050506040513d60208110156108de57600080fd5b505110156109365760408051600160e51b62461bcd02815260206004820152601460248201527f4e6f7420656e6f75676820616c6c6f77616e6365000000000000000000000000604482015290519081900360640190fd5b60408051600160e01b6323b872dd0281526001600160a01b038881166004830152306024830152604482018790529151918716916323b872dd916064808201926020929091908290030181600087803b15801561099257600080fd5b505af11580156109a6573d6000803e3d6000fd5b505050506040513d60208110156109bc57600080fd5b50506003546000906001600160a01b031615610b1d576003546001600160a01b03878116911614610b1557856001600160a01b031663095ea7b383876040518363ffffffff1660e01b815260040180836001600160a01b03166001600160a01b0316815260200182815260200192505050602060405180830381600087803b158015610a4757600080fd5b505af1158015610a5b573d6000803e3d6000fd5b505050506040513d6020811015610a7157600080fd5b505060035460408051600160e01b63ddf7e1a702815260048101889052600160248201819052604482015260001960648201526001600160a01b03928316608482015290519184169163ddf7e1a79160a4808201926020929091908290030181600087803b158015610ae257600080fd5b505af1158015610af6573d6000803e3d6000fd5b505050506040513d6020811015610b0c57600080fd5b50519050610b18565b50835b610c33565b856001600160a01b031663095ea7b383876040518363ffffffff1660e01b815260040180836001600160a01b03166001600160a01b0316815260200182815260200192505050602060405180830381600087803b158015610b7d57600080fd5b505af1158015610b91573d6000803e3d6000fd5b505050506040513d6020811015610ba757600080fd5b505060408051600160e01b6395e3c50b0281526004810187905260016024820152600019604482015290516001600160a01b038416916395e3c50b9160648083019260209291908290030181600087803b158015610c0457600080fd5b505af1158015610c18573d6000803e3d6000fd5b505050506040513d6020811015610c2e57600080fd5b505190505b600354604080518781526001600160a01b03928316602082015280820184905290519188169167ffffffffffffffff8b16917febd88c5025c59e3be6d1c60933148c79b5dafc02e8b14ee438a59dedf03c132e919081900360600190a35050505050505050565b6001546001600160a01b031681565b60003411610d015760408051600160e51b62461bcd02815260206004820152601460248201527f4d696e696d616c206465706f7369742069732030000000000000000000000000604482015290519081900360640190fd5b6003546000906001600160a01b031615610da1576004805460408051600160e01b63f39b5b9b0281526001938101939093526000196024840152516001600160a01b039091169163f39b5b9b91349160448082019260209290919082900301818588803b158015610d7157600080fd5b505af1158015610d85573d6000803e3d6000fd5b50505050506040513d6020811015610d9c57600080fd5b505190505b600354604080513481526001600160a01b0390921660208301528181018390525167ffffffffffffffff8416917f87c7bfd98aa2bdc25bce042b733bfc4db29ea3b69e6ddbe794486ff29e06fa02919081900360600190a25050565b610e05610e76565b610e0e57600080fd5b600080546040516001600160a01b03909116907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a3600080546001600160a01b0319169055565b6002546001600160a01b031681565b6000546001600160a01b031690565b6000546001600160a01b0316331490565b6003546001600160a01b031681565b6000610ea0610e76565b80610eb557506001546001600160a01b031633145b905090565b610ec2610e96565b610f045760408051600160e51b62461bcd028152602060048201526019602482015260008051602061104d833981519152604482015290519081900360640190fd5b6040516001600160a01b0382169083156108fc029084906000818181858888f19350505050158015610f3a573d6000803e3d6000fd5b50604080516001600160a01b03831681526020810184905281517fa80a423a219a317d60725b886de320e87e5653b13614d536e8b741c0ba1e5ecd929181900390910190a15050565b610f8b610e76565b610f9457600080fd5b6104f4816001600160a01b038116610fab57600080fd5b600080546040516001600160a01b03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a3600080546001600160a01b0319166001600160a01b039290921691909117905556fe54686520746f6b656e20646f6573206e6f74206861766520616e2065786368616e6765496e70757420746f6b656e2063616e6e6f6e74206265205a45524f5f414444524553534f6e6c792066756e64206d616e6167657220616c6c6f77656400000000000000a165627a7a723058201aab07c875483b4b2bdd26fcb341b7d06af53fa92c64c7090f00d5d29e5346050029000000000000000000000000c0a47dfe034b400b47bdad5fecda2621de6c4d95",
  "constructorArguments": "000000000000000000000000c0a47dfe034b400b47bdad5fecda2621de6c4d95"
}